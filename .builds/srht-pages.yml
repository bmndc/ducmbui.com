image: debian/stable
oauth: pages.sr.ht/PAGES:RW
packages:
  - ruby-full
  - ruby-dev
  - hut
environment:
  site: ducmbui.com
  PATH: $(ruby -e 'puts Gem.user_dir')/bin:$PATH
tasks:
  - install-bundler: |
      echo 'export PATH=$(ruby -e 'puts Gem.user_dir')/bin:$PATH' >> ~/.buildenv
      source ~/.buildenv
      gem install --user-install bundler
  - build: |
      cd $site
      bundle install
      bundle exec jekyll build
  - package: |
      cd $site/_site
      tar -cvz . > ../../site.tar.gz
  - upload: |
      hut pages publish -d $site site.tar.gz
